[Unit]
Description=Witnessd Cryptographic Authorship Witnessing Daemon
Documentation=man:witnessd(1)
Documentation=https://github.com/writerslogic/witnessd
After=network.target local-fs.target
Wants=witnessd.socket

[Service]
Type=notify
User=witnessd
Group=witnessd

# Configuration
EnvironmentFile=-/etc/witnessd/environment
ExecStart=/usr/bin/witnessd --config /etc/witnessd/config.toml
ExecReload=/bin/kill -HUP $MAINPID
Restart=on-failure
RestartSec=5
TimeoutStartSec=30
TimeoutStopSec=30
WatchdogSec=60

# Logging
StandardOutput=journal
StandardError=journal
SyslogIdentifier=witnessd

# Paths
RuntimeDirectory=witnessd
RuntimeDirectoryMode=0750
StateDirectory=witnessd
StateDirectoryMode=0750
LogsDirectory=witnessd
LogsDirectoryMode=0750
ConfigurationDirectory=witnessd
ConfigurationDirectoryMode=0750

# Security hardening
NoNewPrivileges=yes
PrivateTmp=yes
PrivateDevices=yes
ProtectSystem=strict
ProtectHome=read-only
ProtectKernelTunables=yes
ProtectKernelModules=yes
ProtectKernelLogs=yes
ProtectControlGroups=yes
ProtectHostname=yes
ProtectClock=yes
ProtectProc=invisible
ProcSubset=pid
RestrictAddressFamilies=AF_UNIX AF_INET AF_INET6
RestrictNamespaces=yes
RestrictRealtime=yes
RestrictSUIDSGID=yes
LockPersonality=yes
MemoryDenyWriteExecute=yes
RemoveIPC=yes
UMask=0077

# Capabilities
CapabilityBoundingSet=
AmbientCapabilities=

# Resource limits
LimitNOFILE=65536
LimitNPROC=64
LimitCORE=0

# cgroups resource control
CPUQuota=50%
MemoryMax=512M
TasksMax=64

# Sandboxing
SystemCallArchitectures=native
SystemCallFilter=@system-service
SystemCallFilter=~@privileged @resources @mount @swap @reboot @obsolete

[Install]
WantedBy=multi-user.target

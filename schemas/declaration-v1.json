{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://witnessd.io/schemas/declaration-v1.json",
  "title": "Process Declaration",
  "description": "A cryptographically signed attestation describing how a document was created. Unknown fields are preserved for forward compatibility.",
  "type": "object",
  "required": [
    "document_hash",
    "chain_hash",
    "title",
    "input_modalities",
    "statement",
    "created_at",
    "version",
    "author_public_key",
    "signature"
  ],
  "properties": {
    "document_hash": {
      "type": "string",
      "description": "SHA-256 hash of the document (hex-encoded, 64 characters, case-insensitive)",
      "pattern": "^[a-fA-F0-9]{64}$"
    },
    "chain_hash": {
      "type": "string",
      "description": "Hash of the associated checkpoint chain (hex-encoded, 64 characters, case-insensitive)",
      "pattern": "^[a-fA-F0-9]{64}$"
    },
    "title": {
      "type": "string",
      "description": "Human-readable document title",
      "minLength": 1,
      "maxLength": 500
    },
    "input_modalities": {
      "type": "array",
      "description": "How content was physically created. Percentages must sum to 95-105% (validation is implementation-side).",
      "minItems": 1,
      "items": {
        "$ref": "#/$defs/InputModality"
      }
    },
    "ai_tools": {
      "type": "array",
      "description": "AI tools used in creation. Empty array explicitly declares 'no AI tools were used'. Field absence means 'not declared' (distinct from empty).",
      "items": {
        "$ref": "#/$defs/AIToolUsage"
      }
    },
    "collaborators": {
      "type": "array",
      "description": "Human collaborators involved",
      "items": {
        "$ref": "#/$defs/Collaborator"
      }
    },
    "statement": {
      "type": "string",
      "description": "Free-form attestation statement (legally meaningful)",
      "minLength": 10,
      "maxLength": 10000
    },
    "created_at": {
      "type": "string",
      "description": "When declaration was made (RFC 3339 timestamp)",
      "format": "date-time"
    },
    "version": {
      "type": "integer",
      "description": "Schema version number",
      "const": 1
    },
    "author_public_key": {
      "type": "string",
      "description": "Ed25519 public key of declarant (base64 or hex encoded, 32 bytes raw)",
      "minLength": 32
    },
    "signature": {
      "type": "string",
      "description": "Ed25519 signature over canonical payload (base64 or hex encoded, 64 bytes raw). See specs/process-declaration.md for signing algorithm.",
      "minLength": 64
    },
    "jitter_sealed": {
      "$ref": "#/$defs/DeclarationJitter",
      "description": "Jitter seal captured during interactive declaration (WAR/1.1)"
    }
  },
  "$defs": {
    "InputModality": {
      "type": "object",
      "description": "Describes how content was physically created",
      "required": ["type", "percentage"],
      "properties": {
        "type": {
          "$ref": "#/$defs/ModalityType"
        },
        "percentage": {
          "type": "number",
          "description": "Estimated percentage of content (0-100)",
          "minimum": 0,
          "maximum": 100
        },
        "note": {
          "type": "string",
          "description": "Optional clarification",
          "maxLength": 500
        }
      }
    },
    "ModalityType": {
      "type": "string",
      "description": "Input method type: keyboard (direct typing), dictation (voice-to-text), handwriting (tablet/scanned), paste (clipboard), import (from files), mixed (cannot separate), other",
      "enum": [
        "keyboard",
        "dictation",
        "handwriting",
        "paste",
        "import",
        "mixed",
        "other"
      ]
    },
    "AIToolUsage": {
      "type": "object",
      "description": "Documents use of an AI tool",
      "required": ["tool", "purpose", "extent"],
      "properties": {
        "tool": {
          "type": "string",
          "description": "Name of the AI tool (e.g., 'Claude', 'GPT-4', 'Copilot')",
          "minLength": 1,
          "maxLength": 100
        },
        "version": {
          "type": "string",
          "description": "Version of the tool if known",
          "maxLength": 50
        },
        "purpose": {
          "$ref": "#/$defs/AIPurpose"
        },
        "interaction": {
          "type": "string",
          "description": "Description of how the tool was used",
          "maxLength": 1000
        },
        "extent": {
          "$ref": "#/$defs/AIExtent"
        },
        "sections": {
          "type": "array",
          "description": "Which document sections were affected",
          "items": {
            "type": "string",
            "maxLength": 200
          }
        }
      }
    },
    "AIPurpose": {
      "type": "string",
      "description": "What the AI tool was used for: ideation (generating ideas), outline (structuring), drafting (writing content), feedback (reviewing), editing (improving), research (finding info), formatting (structure), other",
      "enum": [
        "ideation",
        "outline",
        "drafting",
        "feedback",
        "editing",
        "research",
        "formatting",
        "other"
      ]
    },
    "AIExtent": {
      "type": "string",
      "description": "Degree of AI involvement: none (used but rejected all), minimal (grammar/word suggestions), moderate (paragraph-level), substantial (major portions)",
      "enum": [
        "none",
        "minimal",
        "moderate",
        "substantial"
      ]
    },
    "Collaborator": {
      "type": "object",
      "description": "Documents a human collaborator",
      "required": ["name", "role"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Collaborator's name",
          "minLength": 1,
          "maxLength": 200
        },
        "role": {
          "$ref": "#/$defs/CollaboratorRole"
        },
        "sections": {
          "type": "array",
          "description": "Which sections they contributed to",
          "items": {
            "type": "string",
            "maxLength": 200
          }
        },
        "public_key": {
          "type": "string",
          "description": "Their witnessd Ed25519 public key (if they have one)"
        }
      }
    },
    "CollaboratorRole": {
      "type": "string",
      "description": "Collaborator's role: co-author (joint authorship), editor (revised work), research_assistant (gathered sources), reviewer (feedback only), transcriber (converted dictation), other",
      "enum": [
        "co-author",
        "editor",
        "research_assistant",
        "reviewer",
        "transcriber",
        "other"
      ]
    },
    "DeclarationJitter": {
      "type": "object",
      "description": "Jitter seal captured during interactive declaration (WAR/1.1). Binds typing proof to the declaration for enhanced authenticity.",
      "required": ["jitter_hash", "keystroke_count", "duration_ms", "avg_interval_ms", "entropy_bits", "hardware_sealed"],
      "properties": {
        "jitter_hash": {
          "type": "string",
          "description": "SHA-256 hash of accumulated jitter samples (hex-encoded)",
          "pattern": "^[a-fA-F0-9]{64}$"
        },
        "keystroke_count": {
          "type": "integer",
          "description": "Total keystrokes during declaration",
          "minimum": 0
        },
        "duration_ms": {
          "type": "integer",
          "description": "Duration of declaration typing in milliseconds",
          "minimum": 0
        },
        "avg_interval_ms": {
          "type": "number",
          "description": "Average interval between keystrokes in milliseconds",
          "minimum": 0
        },
        "entropy_bits": {
          "type": "number",
          "description": "Estimated entropy in bits from timing jitter",
          "minimum": 0
        },
        "hardware_sealed": {
          "type": "boolean",
          "description": "Whether jitter was captured via hardware entropy source (physjitter)"
        }
      }
    }
  },
  "examples": [
    {
      "document_hash": "a3f2b8c9d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1",
      "chain_hash": "1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b",
      "title": "Quarterly Report Q4 2025",
      "input_modalities": [
        {
          "type": "keyboard",
          "percentage": 100.0
        }
      ],
      "ai_tools": [],
      "collaborators": [],
      "statement": "I declare this document was authored entirely by me without AI assistance.",
      "created_at": "2026-01-25T14:30:00Z",
      "version": 1,
      "author_public_key": "mC5qZ3JkYXNkZmFzZGZhc2RmYXNkZmFzZGZhc2Rm",
      "signature": "c2lnbmF0dXJlLi4u..."
    }
  ]
}

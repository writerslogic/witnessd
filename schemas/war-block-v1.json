{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://witnessd.io/schemas/war-block-v1.json",
  "title": "WAR Block",
  "description": "Witnessd Authorship Record (WAR) block - an ASCII-armored evidence format",
  "type": "object",
  "required": [
    "version",
    "author",
    "document_id",
    "timestamp",
    "statement",
    "seal"
  ],
  "properties": {
    "version": {
      "$ref": "#/$defs/Version"
    },
    "author": {
      "type": "string",
      "description": "Author identifier (from declaration or public key fingerprint)",
      "minLength": 1
    },
    "document_id": {
      "type": "string",
      "description": "Document identifier (SHA-256 of final content, hex-encoded)",
      "pattern": "^[a-fA-F0-9]{64}$"
    },
    "timestamp": {
      "type": "string",
      "description": "Block creation timestamp (RFC 3339)",
      "format": "date-time"
    },
    "statement": {
      "type": "string",
      "description": "Declaration statement text",
      "minLength": 1
    },
    "seal": {
      "$ref": "#/$defs/Seal"
    },
    "evidence": {
      "description": "Full evidence packet for verification (optional, not included in ASCII output)",
      "$ref": "evidence-v1.json"
    }
  },
  "$defs": {
    "Version": {
      "type": "string",
      "description": "WAR block format version",
      "enum": ["WAR/1.0", "WAR/1.1"]
    },
    "Seal": {
      "type": "object",
      "description": "The cryptographic seal binding all evidence together",
      "required": ["h1", "h2", "h3", "signature", "public_key"],
      "properties": {
        "h1": {
          "type": "string",
          "description": "H1: SHA-256(doc || checkpoint_root || declaration), hex-encoded",
          "pattern": "^[a-fA-F0-9]{64}$"
        },
        "h2": {
          "type": "string",
          "description": "H2: SHA-256(H1 || jitter || pubkey), hex-encoded",
          "pattern": "^[a-fA-F0-9]{64}$"
        },
        "h3": {
          "type": "string",
          "description": "H3: SHA-256(H2 || vdf_output || doc), hex-encoded",
          "pattern": "^[a-fA-F0-9]{64}$"
        },
        "signature": {
          "type": "string",
          "description": "H4: Ed25519 signature of H3, hex-encoded (128 characters)",
          "pattern": "^[a-fA-F0-9]{128}$"
        },
        "public_key": {
          "type": "string",
          "description": "Author's Ed25519 public key for verification, hex-encoded",
          "pattern": "^[a-fA-F0-9]{64}$"
        }
      }
    },
    "VerificationReport": {
      "type": "object",
      "description": "Result of WAR block verification",
      "required": ["valid", "checks", "summary", "details"],
      "properties": {
        "valid": {
          "type": "boolean",
          "description": "Overall verification status"
        },
        "checks": {
          "type": "array",
          "description": "Individual check results",
          "items": {
            "$ref": "#/$defs/CheckResult"
          }
        },
        "summary": {
          "type": "string",
          "description": "Human-readable summary"
        },
        "details": {
          "$ref": "#/$defs/ForensicDetails"
        }
      }
    },
    "CheckResult": {
      "type": "object",
      "description": "Individual verification check result",
      "required": ["name", "passed", "message"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Check name (e.g., 'signature', 'hash_chain', 'vdf', 'declaration')"
        },
        "passed": {
          "type": "boolean",
          "description": "Whether the check passed"
        },
        "message": {
          "type": "string",
          "description": "Human-readable result message"
        }
      }
    },
    "ForensicDetails": {
      "type": "object",
      "description": "Detailed forensic information from verification",
      "properties": {
        "version": {
          "type": "string",
          "description": "Version detected"
        },
        "author": {
          "type": "string",
          "description": "Author identifier"
        },
        "document_id": {
          "type": "string",
          "description": "Document hash"
        },
        "timestamp": {
          "type": "string",
          "description": "Block timestamp",
          "format": "date-time"
        },
        "components": {
          "type": "array",
          "description": "Components included in the evidence",
          "items": {
            "type": "string"
          }
        },
        "elapsed_time_secs": {
          "type": "number",
          "description": "Total elapsed time from VDF proofs (seconds)"
        },
        "checkpoint_count": {
          "type": "integer",
          "description": "Number of checkpoints",
          "minimum": 0
        },
        "keystroke_count": {
          "type": "integer",
          "description": "Keystroke count (if available)",
          "minimum": 0
        },
        "has_jitter_seal": {
          "type": "boolean",
          "description": "Whether jitter seal is present"
        },
        "has_hardware_attestation": {
          "type": "boolean",
          "description": "Whether hardware attestation is present"
        }
      }
    }
  }
}

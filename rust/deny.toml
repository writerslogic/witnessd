[graph]
targets = [
    "x86_64-apple-darwin",
    "aarch64-apple-darwin",
    "x86_64-pc-windows-msvc",
    "x86_64-unknown-linux-gnu",
]

[advisories]
version = 2
ignore = [
    # RSA Marvin Attack - no fix available, low risk for our use case
    "RUSTSEC-2023-0071",
    # rustls-pemfile unmaintained - transitive dep from reqwest, no fix available
    "RUSTSEC-2025-0134",
    # bincode unmaintained - works fine, will migrate eventually
    "RUSTSEC-2025-0141",
    # paste unmaintained - transitive dep from flutter_rust_bridge, no alternative
    "RUSTSEC-2024-0436",
    # derivative unmaintained - transitive dep from zbus, no fix available yet
    "RUSTSEC-2024-0388",
]

[licenses]
version = 2
allow = [
    "MIT",
    "Apache-2.0",
    "Apache-2.0 WITH LLVM-exception",
    "BSD-2-Clause",
    "BSD-3-Clause",
    "ISC",
    "CC0-1.0",
    "OpenSSL",
    "Unicode-DFS-2016",
    "Unicode-3.0",
    "Zlib",
    "MPL-2.0",
]
confidence-threshold = 0.8

# Our own crates use PolyForm Noncommercial license (custom, non-SPDX)
[[licenses.exceptions]]
name = "witnessd-core"
allow = ["PolyForm-Noncommercial-1.0.0"]

[[licenses.exceptions]]
name = "witnessd-cli"
allow = ["PolyForm-Noncommercial-1.0.0"]

# allo-isolate doesn't specify a license in Cargo.toml but is MIT licensed
[[licenses.clarify]]
name = "allo-isolate"
expression = "MIT"
license-files = []

[bans]
multiple-versions = "warn"
wildcards = "deny"
highlight = "all"

# Skip duplicate warnings for transitive dependencies we can't control
# These come from keyring -> zbus -> async ecosystem version conflicts
skip = [
    { crate = "async-io" },
    { crate = "async-lock" },
    { crate = "base64" },
    { crate = "bitflags" },
    { crate = "core-foundation" },
    { crate = "dashmap" },
    { crate = "event-listener" },
    { crate = "fastrand" },
    { crate = "foreign-types" },
    { crate = "foreign-types-shared" },
    { crate = "futures-lite" },
    { crate = "getrandom" },
    { crate = "hashbrown" },
    { crate = "nix" },
    { crate = "polling" },
    { crate = "rand" },
    { crate = "rand_core" },
    { crate = "rand_chacha" },
    { crate = "rustix" },
    { crate = "security-framework" },
    { crate = "security-framework-sys" },
    { crate = "syn" },
    { crate = "windows" },
    { crate = "windows-core" },
    { crate = "windows-result" },
    { crate = "windows-strings" },
    { crate = "windows-sys" },
    { crate = "windows-targets" },
]

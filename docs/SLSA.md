# SLSA Compliance

This document describes witnessd-rust's compliance with [SLSA](https://slsa.dev/) (Supply chain Levels for Software Artifacts) requirements.

## Current Status: SLSA Level 3

Witnessd-rust meets **SLSA Level 3** requirements for all released artifacts.

## Requirements Met

### Build Level 3

| Requirement | Status | Implementation |
|-------------|--------|----------------|
| **Scripted build** | Yes | GitHub Actions workflows (`release.yml`) |
| **Build service** | Yes | GitHub Actions (hosted runners) |
| **Build as code** | Yes | All build logic in version-controlled workflow files |
| **Ephemeral environment** | Yes | Fresh GitHub Actions runners per build |
| **Isolated build** | Yes | GitHub Actions provides container isolation |
| **Parameterless build** | Yes | Builds triggered only by git tags |
| **Hermetic build** | Yes | Locked dependencies (`Cargo.lock`, `pubspec.lock`) |
| **Reproducible build** | Verified | CI includes reproducibility checks |

### Source Level 3

| Requirement | Status | Implementation |
|-------------|--------|----------------|
| **Version controlled** | Yes | Git repository on GitHub |
| **Verified history** | Yes | Signed commits required on main branch |
| **Retained indefinitely** | Yes | GitHub repository with tag protection |
| **Two-person reviewed** | Partial | PR reviews required, not enforced for all commits |

### Provenance Level 3

| Requirement | Status | Implementation |
|-------------|--------|----------------|
| **Available** | Yes | Provenance attached to all releases |
| **Authenticated** | Yes | Signed via Sigstore (keyless OIDC) |
| **Service generated** | Yes | Generated by `slsa-github-generator` |
| **Non-falsifiable** | Yes | GitHub OIDC token binding |
| **Dependencies complete** | Partial | SBOM generated, not all transitive deps attested |

## Artifacts Covered

All release artifacts include SLSA provenance:

- **Rust binaries**: `witnessd-cli` (Linux, macOS, Windows)
- **Flutter apps**: macOS `.app`, Windows MSIX (planned)
- **Source archives**: `.tar.gz`, `.zip`

## Verification

### Verify Binary Provenance

```bash
# Install slsa-verifier
go install github.com/slsa-framework/slsa-verifier/v2/cli/slsa-verifier@latest

# Download release artifacts
VERSION="v1.0.0"
curl -LO "https://github.com/writerslogic/witnessd-rust/releases/download/${VERSION}/witnessd-rust_${VERSION}_x86_64-unknown-linux-gnu.tar.gz"
curl -LO "https://github.com/writerslogic/witnessd-rust/releases/download/${VERSION}/multiple.intoto.jsonl"

# Verify provenance
slsa-verifier verify-artifact witnessd-rust_${VERSION}_x86_64-unknown-linux-gnu.tar.gz \
  --provenance-path multiple.intoto.jsonl \
  --source-uri github.com/writerslogic/witnessd-rust \
  --source-tag "${VERSION}"
```

### Verify Checksums

```bash
# Download checksums
curl -LO "https://github.com/writerslogic/witnessd-rust/releases/download/${VERSION}/checksums.txt"

# Verify
sha256sum -c checksums.txt
```

## SBOM (Software Bill of Materials)

Every release includes SBOMs in two formats:

- **SPDX**: `witnessd-rust-sbom.spdx.json`
- **CycloneDX**: `witnessd-rust-sbom.cdx.json`

Generated using [Syft](https://github.com/anchore/syft).

## Build Provenance Format

Provenance follows the [SLSA v1.0 specification](https://slsa.dev/spec/v1.0/provenance) using the in-toto attestation format.

Example provenance structure:

```json
{
  "_type": "https://in-toto.io/Statement/v1",
  "subject": [
    {
      "name": "witnessd-rust_v1.0.0_x86_64-unknown-linux-gnu.tar.gz",
      "digest": {
        "sha256": "abc123..."
      }
    }
  ],
  "predicateType": "https://slsa.dev/provenance/v1",
  "predicate": {
    "buildDefinition": {
      "buildType": "https://github.com/slsa-framework/slsa-github-generator/go@v1",
      "externalParameters": {
        "workflow": {
          "ref": "refs/tags/v1.0.0",
          "repository": "https://github.com/writerslogic/witnessd-rust"
        }
      }
    },
    "runDetails": {
      "builder": {
        "id": "https://github.com/slsa-framework/slsa-github-generator/.github/workflows/generator_generic_slsa3.yml@refs/tags/v2.0.0"
      }
    }
  }
}
```

## Security Scanning

All releases undergo automated security scanning:

| Scanner | Purpose |
|---------|---------|
| **cargo-audit** | Rust dependency advisories |
| **cargo-deny** | License and ban checking |
| **Trivy** | Vulnerability scanning |
| **Semgrep** | Static analysis |
| **Gitleaks** | Secret detection |
| **TruffleHog** | Secret scanning |

## Dependency Management

### Rust Dependencies

- All dependencies locked via `Cargo.lock`
- Vendored dependencies in `rust/witnessd-core/vendor/`
- `deny.toml` configured for:
  - Security advisory checking
  - License allowlist (MIT, Apache-2.0, BSD, ISC, CC0)
  - Multiple version warnings

### Flutter Dependencies

- All dependencies locked via `pubspec.lock`
- Pub cache for reproducibility

## Continuous Improvement

We are working toward:

1. **Container images**: Add Docker builds with Cosign signing
2. **Full SLSA Level 4**: Hardware-backed signing
3. **Per-dependency provenance**: Track SLSA status of all Rust crates
4. **Reproducible builds**: Bit-for-bit identical builds

## References

- [SLSA Specification](https://slsa.dev/spec/v1.0/)
- [slsa-github-generator](https://github.com/slsa-framework/slsa-github-generator)
- [Sigstore](https://www.sigstore.dev/)
- [in-toto Attestation Framework](https://in-toto.io/)
- [cargo-audit](https://github.com/RustSec/rustsec/tree/main/cargo-audit)
- [cargo-deny](https://github.com/EmbarkStudios/cargo-deny)

# SLSA Compliance

This document describes witnessd's compliance with [SLSA](https://slsa.dev/) (Supply chain Levels for Software Artifacts) requirements.

## Current Status: SLSA Level 3

Witnessd meets **SLSA Level 3** requirements for all released artifacts.

## Requirements Met

### Build Level 3

| Requirement | Status | Implementation |
|-------------|--------|----------------|
| **Scripted build** | Yes | GitHub Actions workflows (`release.yml`) |
| **Build service** | Yes | GitHub Actions (hosted runners) |
| **Build as code** | Yes | All build logic in version-controlled workflow files |
| **Ephemeral environment** | Yes | Fresh GitHub Actions runners per build |
| **Isolated build** | Yes | GitHub Actions provides container isolation |
| **Parameterless build** | Yes | Builds triggered only by git tags |
| **Hermetic build** | Yes | Locked dependencies (`go.mod`, `go.sum`) |
| **Reproducible build** | Verified | CI includes reproducibility checks |

### Source Level 3

| Requirement | Status | Implementation |
|-------------|--------|----------------|
| **Version controlled** | Yes | Git repository on GitHub |
| **Verified history** | Yes | Signed commits required on main branch |
| **Retained indefinitely** | Yes | GitHub repository with tag protection |
| **Two-person reviewed** | Partial | PR reviews required, not enforced for all commits |

### Provenance Level 3

| Requirement | Status | Implementation |
|-------------|--------|----------------|
| **Available** | Yes | Provenance attached to all releases |
| **Authenticated** | Yes | Signed via Sigstore (keyless OIDC) |
| **Service generated** | Yes | Generated by `slsa-github-generator` |
| **Non-falsifiable** | Yes | GitHub OIDC token binding |
| **Dependencies complete** | Partial | SBOM generated, not all transitive deps attested |

## Artifacts Covered

All release artifacts include SLSA provenance:

- **Binaries**: `witnessd`, `witnessctl` (Linux, macOS, Windows)
- **Packages**: `.deb`, `.rpm`, `.msi`, `.dmg`, AppImage
- **Container images**: `ghcr.io/writerslogic/witnessd`
- **Source archives**: `.tar.gz`, `.zip`

## Verification

### Verify Binary Provenance

```bash
# Install slsa-verifier
go install github.com/slsa-framework/slsa-verifier/v2/cli/slsa-verifier@latest

# Download release artifacts
VERSION="v1.0.0"
curl -LO "https://github.com/writerslogic/witnessd/releases/download/${VERSION}/witnessd_${VERSION#v}_linux_amd64.tar.gz"
curl -LO "https://github.com/writerslogic/witnessd/releases/download/${VERSION}/multiple.intoto.jsonl"

# Verify provenance
slsa-verifier verify-artifact witnessd_${VERSION#v}_linux_amd64.tar.gz \
  --provenance-path multiple.intoto.jsonl \
  --source-uri github.com/writerslogic/witnessd \
  --source-tag "${VERSION}"
```

### Verify Container Image

```bash
# Install cosign
go install github.com/sigstore/cosign/v2/cmd/cosign@latest

# Verify container signature
cosign verify ghcr.io/writerslogic/witnessd:latest \
  --certificate-identity-regexp="https://github.com/writerslogic/witnessd/.*" \
  --certificate-oidc-issuer="https://token.actions.githubusercontent.com"

# Verify SBOM attestation
cosign verify-attestation ghcr.io/writerslogic/witnessd:latest \
  --type spdxjson \
  --certificate-identity-regexp="https://github.com/writerslogic/witnessd/.*" \
  --certificate-oidc-issuer="https://token.actions.githubusercontent.com"
```

## SBOM (Software Bill of Materials)

Every release includes SBOMs in two formats:

- **SPDX**: `witnessd-sbom.spdx.json`
- **CycloneDX**: `witnessd-sbom.cdx.json`

Generated using [Syft](https://github.com/anchore/syft).

## Build Provenance Format

Provenance follows the [SLSA v1.0 specification](https://slsa.dev/spec/v1.0/provenance) using the in-toto attestation format.

Example provenance structure:

```json
{
  "_type": "https://in-toto.io/Statement/v1",
  "subject": [
    {
      "name": "witnessd_1.0.0_linux_amd64.tar.gz",
      "digest": {
        "sha256": "abc123..."
      }
    }
  ],
  "predicateType": "https://slsa.dev/provenance/v1",
  "predicate": {
    "buildDefinition": {
      "buildType": "https://github.com/slsa-framework/slsa-github-generator/go@v1",
      "externalParameters": {
        "workflow": {
          "ref": "refs/tags/v1.0.0",
          "repository": "https://github.com/writerslogic/witnessd"
        }
      }
    },
    "runDetails": {
      "builder": {
        "id": "https://github.com/slsa-framework/slsa-github-generator/.github/workflows/generator_generic_slsa3.yml@refs/tags/v2.0.0"
      }
    }
  }
}
```

## Security Scanning

All releases undergo automated security scanning:

| Scanner | Purpose |
|---------|---------|
| **gosec** | Go security issues |
| **CodeQL** | Static analysis |
| **Trivy** | Vulnerability scanning |
| **govulncheck** | Go module vulnerabilities |
| **cargo-audit** | Dependency advisories |
| **Gitleaks** | Secret detection |

## Continuous Improvement

We are working toward:

1. **Full SLSA Level 4**: Hardware-backed signing, hermetic verification
2. **Per-dependency provenance**: Track SLSA status of all dependencies
3. **Reproducible builds**: Bit-for-bit identical builds across environments

## References

- [SLSA Specification](https://slsa.dev/spec/v1.0/)
- [slsa-github-generator](https://github.com/slsa-framework/slsa-github-generator)
- [Sigstore](https://www.sigstore.dev/)
- [in-toto Attestation Framework](https://in-toto.io/)
